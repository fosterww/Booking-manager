```markdown
# üéüÔ∏è Async Booking Service (High-Load Simulation)

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –±–∏–ª–µ—Ç–æ–≤ (–∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä/–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è), —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø–æ–¥ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π. –†–µ–∞–ª–∏–∑—É–µ—Ç –∑–∞—â–∏—Ç—É –æ—Ç **Race Conditions** (—Å–æ—Å—Ç–æ—è–Ω–∏—è –≥–æ–Ω–∫–∏) –∏ –¥–≤–æ–π–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂.

![Python](https://img.shields.io/badge/Python-3.10+-blue?style=flat&logo=python)
![FastAPI](https://img.shields.io/badge/FastAPI-0.100+-green?style=flat&logo=fastapi)
![Redis](https://img.shields.io/badge/Redis-7.0-red?style=flat&logo=redis)
![Kubernetes](https://img.shields.io/badge/Kubernetes-Ready-blueviolet?style=flat&logo=kubernetes)

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π I/O –Ω–∞ –±–∞–∑–µ `asyncio` –∏ `redis-py`.
* **–ó–∞—â–∏—Ç–∞ –æ—Ç Race Condition:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞—Ç–æ–º–∞—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π Redis (`SET NX`) –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –¥–≤—É–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
* **–í—Ä–µ–º–µ–Ω–Ω–∞—è –±—Ä–æ–Ω—å (TTL):** –ú–µ—Å—Ç–æ –±—Ä–æ–Ω–∏—Ä—É–µ—Ç—Å—è –Ω–∞ 5 –º–∏–Ω—É—Ç. –ï—Å–ª–∏ –ø–æ–∫—É–ø–∫–∞ –Ω–µ —Å–æ–≤–µ—Ä—à–µ–Ω–∞, Redis –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Å–ª–æ—Ç.
* **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
    * **Dependency Injection:** –ö–ª–∏–µ–Ω—Ç Redis –≤–Ω–µ–¥—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `Depends`.
    * **Pydantic Settings:** –°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ —á—Ç–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.
    * **Graceful Shutdown:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–µ—Ä–≤–∏—Å–∞.
* **DevOps:**
    * –£–ø–∞–∫–æ–≤–∫–∞ –≤ **Docker**.
    * –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ **Kubernetes** (Deployment + Service).
    * –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã **Liveness & Readiness Probes** –¥–ª—è —Å–∞–º–æ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–¥–æ–≤.

---

## üõ†Ô∏è –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

* **–Ø–∑—ã–∫:** Python 3.10
* **Web Framework:** FastAPI
* **Database:** Redis (—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, TTL)
* **Containerization:** Docker
* **Orchestration:** Kubernetes
* **Testing:** Pytest, TestClient, FakeRedis (Mock)

---

## üèÉ‚Äç‚ôÇÔ∏è –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –õ–æ–∫–∞–ª—å–Ω–æ (–±–µ–∑ Docker)

–¢—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø—É—â–µ–Ω–Ω—ã–π Redis –Ω–∞ `localhost:6379`.

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   pip install fastapi uvicorn redis pydantic-settings

```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:
```bash
uvicorn main:app --reload

```


Swagger UI –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:8000/docs`

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í Kubernetes (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Docker –∏ –≤–∫–ª—é—á–µ–Ω Kubernetes (Minikube –∏–ª–∏ Docker Desktop).

1. **–°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞:**
```bash
docker build -t booking-app:v1 .

```


2. **–î–µ–ø–ª–æ–π –≤ –∫–ª–∞—Å—Ç–µ—Ä:**
```bash
kubectl apply -f k8s-deployment.yaml

```


3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:**
```bash
kubectl get pods

```


*–ü–æ–¥–æ–∂–¥–∏—Ç–µ, –ø–æ–∫–∞ —Å—Ç–∞—Ç—É—Å –ø–æ–¥–æ–≤ —Å—Ç–∞–Ω–µ—Ç `Running`. –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –¥–æ–ª–≥–æ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏.*
4. **–î–æ—Å—Ç—É–ø –∫ API:**
–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: [http://localhost:8000/docs](https://www.google.com/search?q=http://localhost:8000/docs)
*–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –¥–ª—è Minikube: –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `minikube service booking-service`, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å URL.*

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –ø–æ–∫—Ä—ã—Ç unit-—Ç–µ—Å—Ç–∞–º–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–∫–æ–≤ (FakeRedis), –ø–æ—ç—Ç–æ–º—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ **–Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è** –ø–æ–¥–Ω–∏–º–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
```bash
pip install pytest httpx pytest-asyncio

```


2. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:
```bash
pytest test_main.py -v

```

---

## üîå –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API

### 1. –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –º–µ—Å—Ç–æ (Reserve)

–ú–µ—Å—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞ 5 –º–∏–Ω—É—Ç (TTL).

**POST** `/reserve`

```json
{
  "seat_id": "1A",
  "user_id": "user_123"
}

```

* **200 OK**: `{"status": "reserved"}` ‚Äî –£—Å–ø–µ—à–Ω–æ.
* **409 Conflict**: –ú–µ—Å—Ç–æ —É–∂–µ –∑–∞–Ω—è—Ç–æ –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

### 2. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–∫—É–ø–∫—É (Buy)

–ü–æ–∫—É–ø–∫–∞ –≤–æ–∑–º–æ–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –±—Ä–æ–Ω—å –Ω–∞ —ç—Ç–æ –º–µ—Å—Ç–æ.

**POST** `/buy`

```json
{
  "seat_id": "1A",
  "user_id": "user_123"
}

```

* **200 OK**: `{"status": "sold"}` ‚Äî –£—Å–ø–µ—à–Ω–æ, —Å—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π.
* **400 Bad Request**: –ë—Ä–æ–Ω—å –∏—Å—Ç–µ–∫–ª–∞ –∏–ª–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –¥—Ä—É–≥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

### 3. –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–µ—Å—Ç–∞

**GET** `/seats/{seat_id}`

* –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `Available`, `Reserved` –∏–ª–∏ `Sold`.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ main.py               # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FastAPI –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ config.py             # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π (Pydantic Settings)
‚îú‚îÄ‚îÄ k8s-deployment.yaml   # –ú–∞–Ω–∏—Ñ–µ—Å—Ç—ã –¥–ª—è Kubernetes (Redis + App + Services)
‚îú‚îÄ‚îÄ Dockerfile            # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞
‚îú‚îÄ‚îÄ test_main.py          # –¢–µ—Å—Ç—ã —Å –º–æ–∫–∞–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ requirements.txt      # –°–ø–∏—Å–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îî‚îÄ‚îÄ README.md             # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

